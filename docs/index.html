<!doctype html>
<html lang="ko" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2025 ì§€ë°©ê¸°ëŠ¥ê²½ê¸°ëŒ€íšŒ Terraform í’€ì´</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Noto+Sans+KR:wght@400;500;700&display=swap"
    rel="stylesheet"
  />

  <style>
    body { box-sizing: border-box; }
    .code-font { font-family: 'JetBrains Mono', monospace; }
    .scroll-smooth { scroll-behavior: smooth; }
    .code-block { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
    .step-card { transition: all 0.3s ease; }
    .step-card:hover { transform: translateY(-2px); }
    pre { white-space: pre-wrap; word-wrap: break-word; }
    .copy-btn { transition: all 0.2s ease; }
    .copy-btn:hover { transform: scale(1.05); }
    .architecture-diagram { background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%); }
  </style>
</head>

<body class="h-full bg-slate-900 text-slate-100 overflow-auto" style="font-family: 'Noto Sans KR', sans-serif;">
  <div class="min-h-full w-full">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-slate-900/95 backdrop-blur border-b border-slate-700/50">
      <div class="max-w-7xl mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
              </svg>
            </div>
            <div>
              <h1 id="main-title" class="text-xl font-bold text-white">2025 ì§€ë°©ê¸°ëŠ¥ê²½ê¸°ëŒ€íšŒ Terraform í’€ì´</h1>
              <p class="text-sm text-slate-400">AWS í´ë¼ìš°ë“œ ì¸í”„ë¼ êµ¬ì¶• ê°€ì´ë“œ</p>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <span class="px-3 py-1 text-xs font-medium bg-emerald-500/20 text-emerald-400 rounded-full">Terraform</span>
            <span class="px-3 py-1 text-xs font-medium bg-amber-500/20 text-amber-400 rounded-full">AWS</span>
          </div>
        </div>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 py-6">

      <!-- Architecture Overview -->
      <section class="mb-8">
        <div class="architecture-diagram rounded-2xl p-6 border border-slate-700/50">
          <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2" />
            </svg>
            ì•„í‚¤í…ì²˜ ê°œìš”
          </h2>

          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-slate-800/50 rounded-xl p-4 text-center border border-slate-600/30">
              <div class="w-12 h-12 mx-auto mb-2 rounded-lg bg-blue-500/20 flex items-center justify-center"><span class="text-2xl">ğŸŒ</span></div>
              <p class="text-sm font-medium text-slate-200">VPC</p>
              <p class="text-xs text-slate-400">10.101.0.0/16</p>
            </div>

            <div class="bg-slate-800/50 rounded-xl p-4 text-center border border-slate-600/30">
              <div class="w-12 h-12 mx-auto mb-2 rounded-lg bg-green-500/20 flex items-center justify-center"><span class="text-2xl">âš–ï¸</span></div>
              <p class="text-sm font-medium text-slate-200">ALB</p>
              <p class="text-xs text-slate-400">Public Subnet</p>
            </div>

            <div class="bg-slate-800/50 rounded-xl p-4 text-center border border-slate-600/30">
              <div class="w-12 h-12 mx-auto mb-2 rounded-lg bg-purple-500/20 flex items-center justify-center"><span class="text-2xl">ğŸ³</span></div>
              <p class="text-sm font-medium text-slate-200">ECS</p>
              <p class="text-xs text-slate-400">EC2 Launch Type</p>
            </div>

            <div class="bg-slate-800/50 rounded-xl p-4 text-center border border-slate-600/30">
              <div class="w-12 h-12 mx-auto mb-2 rounded-lg bg-orange-500/20 flex items-center justify-center"><span class="text-2xl">ğŸ—„ï¸</span></div>
              <p class="text-sm font-medium text-slate-200">DynamoDB</p>
              <p class="text-xs text-slate-400">Product Table</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Navigation Tabs (onclick ì œê±° + data-step ì‚¬ìš©) -->
      <div id="tabs" class="flex gap-2 mb-6 overflow-x-auto pb-2 snap-x snap-mandatory">
        <button data-step="0" class="step-tab px-4 py-2 rounded-lg text-sm font-medium bg-amber-500 text-slate-900 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start">ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°</button>
        <button data-step="1" class="step-tab px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start">ğŸ”§ Provider</button>
        <button data-step="2" class="step-tab px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start">ğŸŒ VPC</button>
        <button data-step="3" class="step-tab px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start">ğŸ”’ Security</button>
        <button data-step="4" class="step-tab px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start">ğŸ’» Bastion</button>
        <button data-step="5" class="step-tab px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start">ğŸ“¦ ECR</button>
        <button data-step="6" class="step-tab px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start">ğŸ³ ECS</button>
        <button data-step="7" class="step-tab px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start">âš–ï¸ ALB</button>
        <button data-step="8" class="step-tab px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start">ğŸ—„ï¸ DynamoDB</button>
      </div>

      <!-- Content Area -->
      <div id="content-area" class="space-y-6"></div>

      <!-- Quick Reference -->
      <section class="mt-8 bg-slate-800/50 rounded-2xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-bold text-white mb-4">ğŸ“‹ ë¹ ë¥¸ ì°¸ì¡°</h3>
        <div class="grid md:grid-cols-3 gap-4">
          <div class="bg-slate-900/50 rounded-xl p-4">
            <h4 class="font-medium text-amber-400 mb-2">Terraform ëª…ë ¹ì–´</h4>
            <div class="space-y-1 text-sm code-font text-slate-300">
              <p>terraform init</p>
              <p>terraform plan</p>
              <p>terraform apply</p>
              <p>terraform destroy</p>
            </div>
          </div>
          <div class="bg-slate-900/50 rounded-xl p-4">
            <h4 class="font-medium text-emerald-400 mb-2">ë¦¬ì†ŒìŠ¤ ë„¤ì´ë°</h4>
            <div class="space-y-1 text-sm text-slate-300">
              <p>VPC: ws-vpc</p>
              <p>Subnet: ws-pub-a, ws-priv-a</p>
              <p>ECS: ws-cluster</p>
            </div>
          </div>
          <div class="bg-slate-900/50 rounded-xl p-4">
            <h4 class="font-medium text-blue-400 mb-2">CIDR ë¸”ë¡</h4>
            <div class="space-y-1 text-sm code-font text-slate-300">
              <p>VPC: 10.101.0.0/16</p>
              <p>Public: 10.101.0.0/24, .1.0/24</p>
              <p>Private: 10.101.2.0/24, .3.0/24</p>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="border-t border-slate-700/50 mt-8">
      <div class="max-w-7xl mx-auto px-4 py-4 text-center text-sm text-slate-500">
        2025 ì§€ë°©ê¸°ëŠ¥ê²½ê¸°ëŒ€íšŒ í´ë¼ìš°ë“œì»´í“¨íŒ… ê³¼ì œ í’€ì´ ê°€ì´ë“œ
      </div>
    </footer>
  </div>

  <script>
    const steps = [
      {
        title: "í”„ë¡œì íŠ¸ êµ¬ì¡°",
        icon: "ğŸ“",
        description: "Terraform í”„ë¡œì íŠ¸ì˜ ê¸°ë³¸ í´ë” ë° íŒŒì¼ êµ¬ì¡°ì…ë‹ˆë‹¤.",
        code: `project-root/
â”œâ”€â”€ main.tf          # Provider ë° Backend ì„¤ì •
â”œâ”€â”€ variables.tf     # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ outputs.tf       # ì¶œë ¥ê°’ ì •ì˜
â”œâ”€â”€ vpc.tf           # VPC, Subnet, IGW, NAT êµ¬ì„±
â”œâ”€â”€ sg.tf            # Security Group ì„¤ì •
â”œâ”€â”€ bastion.tf       # Bastion EC2 ì¸ìŠ¤í„´ìŠ¤
â”œâ”€â”€ ecr.tf           # ECR ë ˆí¬ì§€í† ë¦¬
â”œâ”€â”€ ecs.tf           # ECS Cluster, Task, Service
â”œâ”€â”€ alb.tf           # Application Load Balancer
â”œâ”€â”€ dynamodb.tf      # DynamoDB í…Œì´ë¸”
â”œâ”€â”€ cloudmap.tf      # Cloud Map ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬
â””â”€â”€ cloudwatch.tf    # CloudWatch ë¡œê·¸ ë° ëŒ€ì‹œë³´ë“œ`
      },
      {
        title: "Provider & Backend",
        icon: "ğŸ”§",
        description: "AWS Provider ë° Terraform Backend ì„¤ì •ì…ë‹ˆë‹¤.",
        code: `# main.tf

provider "aws" {
  region = var.aws_region
}

terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }

  backend "local" {
    path = "terraform.tfstate"
  }
}

# variables.tf

variable "aws_region" {
  description = "AWS region to deploy to"
  default     = "ap-northeast-2"
}

variable "project" {
  description = "Project name prefix"
  default     = "skills2025"
}`
      },
      {
        title: "VPC êµ¬ì„±",
        icon: "ğŸŒ",
        description: "VPC, Subnet, Internet Gateway, NAT Gateway, Route Tableì„ êµ¬ì„±í•©ë‹ˆë‹¤.",
        code: `# vpc.tf

resource "aws_vpc" "main" {
  cidr_block           = "10.101.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name = "ws-vpc"
  }
}

resource "aws_internet_gateway" "igw" {
  vpc_id = aws_vpc.main.id

  tags = {
    Name = "ws-igw"
  }
}

resource "aws_eip" "nat_eip" {
  domain = "vpc"

  tags = {
    Name = "ws-nat-eip"
  }
}

resource "aws_subnet" "pub_a" {
  vpc_id                  = aws_vpc.main.id
  cidr_block              = "10.101.0.0/24"
  availability_zone       = "ap-northeast-2a"
  map_public_ip_on_launch = true

  tags = {
    Name = "ws-pub-a"
  }
}

resource "aws_subnet" "pub_c" {
  vpc_id                  = aws_vpc.main.id
  cidr_block              = "10.101.1.0/24"
  availability_zone       = "ap-northeast-2c"
  map_public_ip_on_launch = true

  tags = {
    Name = "ws-pub-c"
  }
}

resource "aws_subnet" "priv_a" {
  vpc_id            = aws_vpc.main.id
  cidr_block        = "10.101.2.0/24"
  availability_zone = "ap-northeast-2a"

  tags = {
    Name = "ws-priv-a"
  }
}

resource "aws_subnet" "priv_c" {
  vpc_id            = aws_vpc.main.id
  cidr_block        = "10.101.3.0/24"
  availability_zone = "ap-northeast-2c"

  tags = {
    Name = "ws-priv-c"
  }
}

resource "aws_nat_gateway" "nat" {
  allocation_id = aws_eip.nat_eip.id
  subnet_id     = aws_subnet.pub_a.id

  tags = {
    Name = "ws-nat-gw"
  }

  depends_on = [aws_internet_gateway.igw]
}

resource "aws_route_table" "pub_rt" {
  vpc_id = aws_vpc.main.id

  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.igw.id
  }

  tags = {
    Name = "ws-pub-rt"
  }
}

resource "aws_route_table" "priv_rt" {
  vpc_id = aws_vpc.main.id

  route {
    cidr_block     = "0.0.0.0/0"
    nat_gateway_id = aws_nat_gateway.nat.id
  }

  tags = {
    Name = "ws-priv-rt"
  }
}

resource "aws_route_table_association" "pub_a" {
  subnet_id      = aws_subnet.pub_a.id
  route_table_id = aws_route_table.pub_rt.id
}

resource "aws_route_table_association" "pub_c" {
  subnet_id      = aws_subnet.pub_c.id
  route_table_id = aws_route_table.pub_rt.id
}

resource "aws_route_table_association" "priv_a" {
  subnet_id      = aws_subnet.priv_a.id
  route_table_id = aws_route_table.priv_rt.id
}

resource "aws_route_table_association" "priv_c" {
  subnet_id      = aws_subnet.priv_c.id
  route_table_id = aws_route_table.priv_rt.id
}`
      },
      {
        title: "Security Groups",
        icon: "ğŸ”’",
        description: "Bastion, ALB, ECSìš© Security Groupì„ ì„¤ì •í•©ë‹ˆë‹¤.",
        code: `# sg.tf

resource "aws_security_group" "bastion" {
  name        = "ws-bastion-sg"
  description = "Security group for Bastion host"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = { Name = "ws-bastion-sg" }
}

resource "aws_security_group" "alb" {
  name        = "ws-alb-sg"
  description = "Security group for ALB"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  ingress {
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = { Name = "ws-alb-sg" }
}

resource "aws_security_group" "ecs" {
  name        = "ws-ecs-sg"
  description = "Security group for ECS tasks"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port       = 0
    to_port         = 65535
    protocol        = "tcp"
    security_groups = [aws_security_group.alb.id]
  }

  ingress {
    from_port = 0
    to_port   = 65535
    protocol  = "tcp"
    self      = true
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = { Name = "ws-ecs-sg" }
}`
      },
      {
        title: "Bastion EC2",
        icon: "ğŸ’»",
        description: "í¼ë¸”ë¦­ ì„œë¸Œë„·ì— Bastion í˜¸ìŠ¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.",
        code: `# bastion.tf

data "aws_ami" "amazon_linux" {
  most_recent = true
  owners      = ["amazon"]

  filter {
    name   = "name"
    values = ["amzn2-ami-hvm-*-x86_64-gp2"]
  }
}

resource "aws_instance" "bastion" {
  ami                         = data.aws_ami.amazon_linux.id
  instance_type               = "t3.micro"
  subnet_id                   = aws_subnet.pub_a.id
  vpc_security_group_ids      = [aws_security_group.bastion.id]
  associate_public_ip_address = true
  key_name                    = "ws-keypair"

  tags = { Name = "ws-bastion" }
}

resource "aws_eip" "bastion" {
  instance = aws_instance.bastion.id
  domain   = "vpc"

  tags = { Name = "ws-bastion-eip" }
}`
      },
      {
        title: "ECR ë ˆí¬ì§€í† ë¦¬",
        icon: "ğŸ“¦",
        description: "Gatewayì™€ Product ì•±ì„ ìœ„í•œ ECR ë ˆí¬ì§€í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.",
        code: `# ecr.tf

resource "aws_ecr_repository" "gateway" {
  name                 = "ws-gateway"
  image_tag_mutability = "MUTABLE"

  image_scanning_configuration {
    scan_on_push = true
  }

  tags = { Name = "ws-gateway" }
}

resource "aws_ecr_repository" "product" {
  name                 = "ws-product"
  image_tag_mutability = "MUTABLE"

  image_scanning_configuration {
    scan_on_push = true
  }

  tags = { Name = "ws-product" }
}

resource "aws_ecr_lifecycle_policy" "gateway" {
  repository = aws_ecr_repository.gateway.name

  policy = jsonencode({
    rules = [{
      rulePriority = 1
      description  = "Keep last 10 images"
      selection = {
        tagStatus   = "any"
        countType   = "imageCountMoreThan"
        countNumber = 10
      }
      action = { type = "expire" }
    }]
  })
}

resource "aws_ecr_lifecycle_policy" "product" {
  repository = aws_ecr_repository.product.name

  policy = jsonencode({
    rules = [{
      rulePriority = 1
      description  = "Keep last 10 images"
      selection = {
        tagStatus   = "any"
        countType   = "imageCountMoreThan"
        countNumber = 10
      }
      action = { type = "expire" }
    }]
  })
}`
      },
      {
        title: "ECS Cluster & Service",
        icon: "ğŸ³",
        description: "ECS Cluster, Task Definition, Serviceë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.",
        code: `# ecs.tf

resource "aws_ecs_cluster" "main" {
  name = "ws-cluster"

  setting {
    name  = "containerInsights"
    value = "enabled"
  }

  tags = { Name = "ws-cluster" }
}

resource "aws_iam_role" "ecs_task_execution" {
  name = "ws-ecs-task-execution-role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17"
    Statement = [{
      Action = "sts:AssumeRole"
      Effect = "Allow"
      Principal = { Service = "ecs-tasks.amazonaws.com" }
    }]
  })
}

resource "aws_iam_role_policy_attachment" "ecs_task_execution" {
  role       = aws_iam_role.ecs_task_execution.name
  policy_arn = "arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"
}

resource "aws_iam_role" "ecs_task" {
  name = "ws-ecs-task-role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17"
    Statement = [{
      Action = "sts:AssumeRole"
      Effect = "Allow"
      Principal = { Service = "ecs-tasks.amazonaws.com" }
    }]
  })
}

resource "aws_ecs_task_definition" "gateway" {
  family                   = "ws-gateway"
  network_mode             = "awsvpc"
  requires_compatibilities = ["EC2"]
  cpu                      = "256"
  memory                   = "512"
  execution_role_arn       = aws_iam_role.ecs_task_execution.arn

  container_definitions = jsonencode([{
    name  = "gateway"
    image = "\${aws_ecr_repository.gateway.repository_url}:latest"
    portMappings = [{
      containerPort = 8080
      hostPort      = 8080
      protocol      = "tcp"
    }]
    logConfiguration = {
      logDriver = "awslogs"
      options = {
        "awslogs-group"         = "/ecs/ws-gateway"
        "awslogs-region"        = "ap-northeast-2"
        "awslogs-stream-prefix" = "ecs"
      }
    }
  }])
}

resource "aws_ecs_task_definition" "product" {
  family                   = "ws-product"
  network_mode             = "awsvpc"
  requires_compatibilities = ["EC2"]
  cpu                      = "256"
  memory                   = "512"
  execution_role_arn       = aws_iam_role.ecs_task_execution.arn
  task_role_arn            = aws_iam_role.ecs_task.arn

  container_definitions = jsonencode([{
    name  = "product"
    image = "\${aws_ecr_repository.product.repository_url}:latest"
    portMappings = [{
      containerPort = 8080
      hostPort      = 8080
      protocol      = "tcp"
    }]
    environment = [{
      name  = "DYNAMODB_TABLE"
      value = "product"
    }]
    logConfiguration = {
      logDriver = "awslogs"
      options = {
        "awslogs-group"         = "/ecs/ws-product"
        "awslogs-region"        = "ap-northeast-2"
        "awslogs-stream-prefix" = "ecs"
      }
    }
  }])
}`
      },
      {
        title: "ALB êµ¬ì„±",
        icon: "âš–ï¸",
        description: "Application Load Balancerì™€ Target Groupì„ ì„¤ì •í•©ë‹ˆë‹¤.",
        code: `# alb.tf

resource "aws_lb" "main" {
  name               = "ws-alb"
  internal           = false
  load_balancer_type = "application"
  security_groups    = [aws_security_group.alb.id]
  subnets            = [aws_subnet.pub_a.id, aws_subnet.pub_c.id]

  tags = { Name = "ws-alb" }
}

resource "aws_lb_target_group" "gateway" {
  name        = "ws-gateway-tg"
  port        = 8080
  protocol    = "HTTP"
  vpc_id      = aws_vpc.main.id
  target_type = "ip"

  health_check {
    enabled             = true
    healthy_threshold   = 2
    interval            = 30
    matcher             = "200"
    path                = "/health"
    port                = "traffic-port"
    protocol            = "HTTP"
    timeout             = 5
    unhealthy_threshold = 2
  }

  tags = { Name = "ws-gateway-tg" }
}

resource "aws_lb_listener" "http" {
  load_balancer_arn = aws_lb.main.arn
  port              = "80"
  protocol          = "HTTP"

  default_action {
    type             = "forward"
    target_group_arn = aws_lb_target_group.gateway.arn
  }
}

resource "aws_service_discovery_private_dns_namespace" "main" {
  name = "ws.local"
  vpc  = aws_vpc.main.id
}

resource "aws_service_discovery_service" "gateway" {
  name = "gateway"

  dns_config {
    namespace_id = aws_service_discovery_private_dns_namespace.main.id
    dns_records { ttl = 10, type = "A" }
    routing_policy = "MULTIVALUE"
  }

  health_check_custom_config { failure_threshold = 1 }
}

resource "aws_service_discovery_service" "product" {
  name = "product"

  dns_config {
    namespace_id = aws_service_discovery_private_dns_namespace.main.id
    dns_records { ttl = 10, type = "A" }
    routing_policy = "MULTIVALUE"
  }

  health_check_custom_config { failure_threshold = 1 }
}`
      },
      {
        title: "DynamoDB",
        icon: "ğŸ—„ï¸",
        description: "Product ë°ì´í„°ë¥¼ ì €ì¥í•  DynamoDB í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤.",
        code: `# dynamodb.tf

resource "aws_dynamodb_table" "product" {
  name         = "product"
  billing_mode = "PAY_PER_REQUEST"
  hash_key     = "id"

  attribute {
    name = "id"
    type = "S"
  }

  tags = { Name = "ws-product-table" }
}

resource "aws_cloudwatch_log_group" "gateway" {
  name              = "/ecs/ws-gateway"
  retention_in_days = 7
  tags = { Name = "ws-gateway-logs" }
}

resource "aws_cloudwatch_log_group" "product" {
  name              = "/ecs/ws-product"
  retention_in_days = 7
  tags = { Name = "ws-product-logs" }
}

# outputs.tf

output "vpc_id" {
  description = "VPC ID"
  value       = aws_vpc.main.id
}

output "alb_dns_name" {
  description = "ALB DNS Name"
  value       = aws_lb.main.dns_name
}

output "ecr_gateway_url" {
  description = "ECR Gateway Repository URL"
  value       = aws_ecr_repository.gateway.repository_url
}

output "ecr_product_url" {
  description = "ECR Product Repository URL"
  value       = aws_ecr_repository.product.repository_url
}

output "bastion_public_ip" {
  description = "Bastion Public IP"
  value       = aws_eip.bastion.public_ip
}`
      }
    ];

    let currentStep = 0;

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function updateTabs(activeIndex) {
      document.querySelectorAll('.step-tab').forEach((tab, i) => {
        if (i === activeIndex) {
          tab.className = 'step-tab px-4 py-2 rounded-lg text-sm font-medium bg-amber-500 text-slate-900 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start';
        } else {
          tab.className = 'step-tab px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 whitespace-nowrap transition-all duration-300 transform hover:scale-105 snap-start';
        }
      });
    }

    function bindInnerButtons() {
      const copyBtn = document.getElementById('copy-btn');
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');

      if (copyBtn) copyBtn.addEventListener('click', copyCode);
      if (prevBtn) prevBtn.addEventListener('click', prevStep);
      if (nextBtn) nextBtn.addEventListener('click', nextStep);
    }

    function showStep(index) {
      currentStep = index;
      const step = steps[index];

      updateTabs(index);

      const contentArea = document.getElementById('content-area');
      contentArea.innerHTML = `
        <div class="step-card bg-slate-800/70 rounded-2xl border border-slate-700/50 overflow-hidden">
          <div class="p-6 border-b border-slate-700/50">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <span class="text-3xl">${step.icon}</span>
                <div>
                  <h2 class="text-xl font-bold text-white">${step.title}</h2>
                  <p class="text-sm text-slate-400 mt-1">${step.description}</p>
                </div>
              </div>

              <button id="copy-btn" class="copy-btn flex items-center gap-2 px-4 py-2 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-lg text-sm font-medium">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
                ë³µì‚¬
              </button>
            </div>
          </div>

          <div class="code-block p-6 overflow-x-auto">
            <pre class="code-font text-sm text-slate-300 leading-relaxed" id="code-content">${escapeHtml(step.code)}</pre>
          </div>
        </div>

        <div class="flex justify-between">
          <button id="prev-btn" class="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-lg text-sm font-medium ${index === 0 ? 'opacity-50 cursor-not-allowed' : ''}">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            ì´ì „
          </button>

          <span class="text-sm text-slate-500 self-center">${index + 1} / ${steps.length}</span>

          <button id="next-btn" class="flex items-center gap-2 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-slate-900 rounded-lg text-sm font-medium ${index === steps.length - 1 ? 'opacity-50 cursor-not-allowed' : ''}">
            ë‹¤ìŒ
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      `;

      bindInnerButtons();
    }

    function copyCode() {
      const code = steps[currentStep].code;
      navigator.clipboard.writeText(code).then(() => {
        const btn = document.getElementById('copy-btn');
        if (!btn) return;

        const original = btn.innerHTML;
        btn.innerHTML = `
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
          ë³µì‚¬ë¨!
        `;
        setTimeout(() => { btn.innerHTML = original; }, 1500);
      });
    }

    function prevStep() {
      if (currentStep > 0) showStep(currentStep - 1);
    }

    function nextStep() {
      if (currentStep < steps.length - 1) showStep(currentStep + 1);
    }

    function bindTabs() {
      document.querySelectorAll('.step-tab').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = Number(btn.dataset.step);
          if (!Number.isFinite(idx)) return;
          showStep(idx);
        });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      bindTabs();
      showStep(0);
    });
  </script>
</body>
</html>

