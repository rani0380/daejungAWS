# 502 오류 해결 체크리스트

### 1. **Target Group 상태 확인**

- [ ]  ALB에 연결된 **Target Group 상태**가 `정상(Healthy)`인지 확인
- [ ]  비정상(Unhealthy)일 경우, 원인을 찾아야 함 (`Request timed out`, `Target response code mismatch` 등)

👉 확인 경로:

**EC2 > Target Group > 대상 탭 > 상태 확인 세부정보**

---

### 2. **Health Check 경로 확인**

- [ ]  ALB Target Group의 상태 검사 경로(`Health check path`)가 `"/"` 또는 실제 응답 가능한 경로인지 확인

👉 예시:

```json
경로: /
트래픽 포트: 8080
프로토콜: HTTP
성공 코드: 200
```

### ✅ 수정 방법

- 대상 서비스가 `/` 경로에 응답하지 않는다면 `경로`를 `/health`나 응답 가능한 URL로 수정
- 경로를 수정한 후 **ALB → 대상 그룹 → 상태 검사 → 편집** 에서 수정 가능

---

### 3. **Fargate 보안 그룹 확인**

- [ ]  Fargate Task에 연결된 보안 그룹 인바운드 규칙에 **ALB의 보안 그룹을 소스로 하는 8080 포트 허용**이 되어 있는지 확인

✅ 예시:

| 유형 | 프로토콜 | 포트 범위 | 소스 |
| --- | --- | --- | --- |
| 사용자 지정 TCP | TCP | 8080 | ALB 보안 그룹 |

---

### 4. **컨테이너 포트 설정 확인**

- [ ]  ECS Task 정의에서 `containerPort: 8080`, `hostPort: 8080`으로 되어 있는지 확인

```json
"portMappings": [
  {
    "containerPort": 8080,
    "hostPort": 8080,
    "protocol": "tcp"
  }
]

```

---

### 5. **ALB 리스너 규칙 확인**

- [ ]  리스너 규칙이 정확한 경로 패턴을 사용하고 있고, 올바른 대상 그룹으로 라우팅되는지 확인

✅ `/` 또는 `/golang-service2*`처럼 현재 서비스 중인 경로와 매칭되는지 확인

---

### 6. **서비스 로그 확인**

- [ ]  CloudWatch에서 로그 그룹 확인 `/ecs/서비스명`
- 오류 로그 (ex. 포트 바인딩 실패, 서버 에러 등) 있는지 확인

---

## ✳️ 예시 테스트 명령어

```bash
curl http://ss02-alb-895311556.ap-northeast-2.elb.amazonaws.com:80/
```

또는 ALB가 라우팅하는 정확한 경로로 테스트:

```bash
curl http://ss02-alb-895311556.ap-northeast-2.elb.amazonaws.com/golang-service2
```

---

## 🎯 요약

| 점검 항목 | 확인/수정 |
| --- | --- |
| Target Group 상태 | ✅ Healthy인지 |
| 상태 검사 경로 | ✅ 실제 응답 가능한 경로 |
| 보안 그룹 | ✅ ALB SG → Fargate SG 8080 허용 |
| 컨테이너 포트 | ✅ 8080으로 매핑 확인 |
| 리스너 규칙 | ✅ 정확한 경로 매칭 |
| CloudWatch 로그 | ✅ 에러 메시지 확인 |